<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Ear Training Game</title>
    </head>
    <body>
        <script type="text/javascript">

            var game = {
                width: 800,
                height: 600,
                framesIntervalTime: 40,        //measured in ms (fps:25)
                scene: {
                    children: [],
                    add: function (newScene) {
                        this.children.push(newScene);
                    },
                    getScene: function (sceneName) {
                        return this.children.find( function (elem) {
                            return elem.name == sceneName;
                        } );
                    },
                    start: function (sceneName) {
                        sceneStart( this.getScene(sceneName) );
                    },
                    stop: function (sceneName) {
                        sceneStop( this.getScene(sceneName) );
                    },
                    pause: function (sceneName) {
                        scenePause( this.getScene(sceneName) );
                    },
                    wake: function (sceneName) {
                        sceneWake( this.getScene(sceneName) );
                    }
                }
            };

            game.scene.add( {
                name: 'Menu',
                status: 'stopped',
                preload: function () {

                },
                create: function () {

                },
                update: function () {

                }
            } );

            game.scene.add( {
                name: 'Game',
                status: 'stopped',
                preload: function () {

                },
                create: function () {

                },
                update: function () {

                }
            } );

            run();
            function run () {
                game.scene.start('Menu');

                var looping = true;
                while (looping) {
                    for (let scene of game.scene.children) {
                        if (scene.status == 'running') {
                            scene.update();
                        }
                    }

                    sleep(framesIntervalTime);
                }
            }

            function sceneStart (scene) {
                console.log(scene.name + ' scene preloading..');
                scene.preload();
                console.log(scene.name + ' scene creating..');
                scene.create();
                console.log(scene.name + ' scene running...');
                scene.status = 'running';
            }
            function sceneStop (scene) {
                console.log(scene.name + ' scene stopped');
                scene.status = 'stopped';
            }
            function scenePause (scene) {
                console.log(scene.name + ' scene paused');
                scene.status = 'paused';
            }
            function sceneWake (scene) {
                if (scene.status == 'paused') {
                    console.log(scene.name + ' scene waked');
                    scene.status = 'running';
                } else {
                    console.log('[ERROR] ' + scene.name + ' scene not paused');
                }
            }

            function sleep (milliseconds) {
                var start = new Date().getTime();
                while(true) {
                    if ( (new Date().getTime() - start) > milliseconds ) { break; }
                }
            }
        </script>
    </body>
</html>
